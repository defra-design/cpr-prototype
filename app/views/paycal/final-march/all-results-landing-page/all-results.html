{% extends "layout.html" %}

{% set serviceName = "pEPR: Regulators' Service" %}
{% set title = "pEPR: Regulators' Service" %}

{% block pageTitle %}
{{ title }} - GOV.UK
{% endblock %}

{% block beforeContent %}
<a class="govuk-back-link" href="javascript:void(0)">Back to home</a>
{% endblock %}

{% block content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <span class="govuk-caption-xl">Calculation run 99</span>
    <h1 class="govuk-heading-xl">Confirm billing instructions</h1>

    <form id="filter-form">
      <p class="govuk-body-m">These billing instructions match those in the results file. Use this screen to confirm
        which instructions you want to accept or reject.</p>
      <p class="govuk-body-m">You can save your progress at any time and return later. Once all instructions have been
        accepted or rejected, you’ll be able to submit them and generate a draft billing file.</p>

      <!-- Search -->
      <div class="moj-filter">
        <div class="moj-filter__content">
          <div class="moj-filter__selected" style="padding: 0px 20px 30px 20px; margin-bottom: 30px;">
            <div class="moj-filter__options" style="box-shadow: inset 0 0 0 0px; padding: 0px;">
              <div class="moj-search">
                <form action="#" method="post">
                  <div class="govuk-form-group">

                    <label class="govuk-label moj-search__label govuk-!-font-weight-bold" for="search">
                      <h2> Search for an organisation</h2>
                    </label>
                    <div id="search-hint" class="govuk-hint moj-search__hint ">
                      Enter an organisation ID to find a billing instruction.
                    </div>
                    <input class="govuk-input moj-search__input " id="search" name="search" type="search"
                      aria-describedby="search-hint" style="width: 828px;">
                  </div>
                  <button type="submit" class="govuk-button moj-search__button" data-module="govuk-button">
                    Search
                  </button>
                </form>
              </div>
            </div>
            </fieldset>
          </div>
        </div>
      </div>


      <div style="margin: 40px 0px;padding: 0px 20px;">
        <h2 class="govuk-heading-m">Filter billing instructions:</h2>

        <!-- Table Filter start-->
        <table class="govuk-table" id="submission-table">
          <thead class="govuk-table__head">
            <tr>
              <td class="govuk-table__cell"
                style="width: 60px; text-align:left; padding: 10px 20px 10px 0px; border-bottom:0px;">All
                (7000)
              </td>
              <td class="govuk-table__cell"
                style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle; border-bottom:0px;">
                <a href="#">Accepted</a> (100)
              </td>
              <td class="govuk-table__cell"
                style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle; border-bottom:0px;">
                <a href="#">Rejected</a> (100)
              </td>
              <td class="govuk-table__cell"
                style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle; border-bottom:0px;">
                <a href="#">Pending</a>
                (6750)
              </td>
            </tr>
            <tr>
              <td class="govuk-table__cell"
                style="width: 60px; text-align:left; padding: 10px 20px 10px 0px; border-bottom:0px;"><a
                  href="#">Inital</a>
              </td>
              <td class="govuk-table__cell"
                style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle; border-bottom:0px;">
                <a href="#">Delta</a>
              </td>
              <td class="govuk-table__cell"
                style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle; border-bottom:0px;">
                <a href="#">Rebill</a>
              </td>
              <td class="govuk-table__cell"
                style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle; border-bottom:0px;">
                <a href="#">Cancel bill</a>
              </td>
              <td class="govuk-table__cell"
                style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle; border-bottom:0px;">
                <a href="#">No action</a>
              </td>
            </tr>
          </thead>
        </table>

        <!-- Select records start -->
        <div class="govuk-form-group" style="margin-bottom:20px;">
          <fieldset class="govuk-fieldset">
            <h3 class="govuk-heading-s" style="margin-bottom: 5px;">Select records</h3>
            <div class="govuk-checkboxes govuk-checkboxes--small" style="display: flex; flex-wrap: wrap;">
              <div class="govuk-checkboxes__item" style="width: 300px !important;">
                <input class="govuk-checkboxes__input" id="status-selectall" name="status" type="checkbox"
                  value="selectall">
                <label class="govuk-label govuk-checkboxes__label" for="selectall">Select all records
                  on this page</label>
              </div>
              <div class="govuk-checkboxes__item" style="width: 300px !important;">
                <input class="govuk-checkboxes__input" id="status-status-select700" name="status" type="checkbox"
                  value="status-select700">
                <label class="govuk-label govuk-checkboxes__label" for="status-select700">Select all 7000
                  records</label>
              </div>
            </div>
          </fieldset>
        </div>
        <!-- Select records end -->
      </div>
    </form>

    <!-- Filtered results start -->
    <div style="padding: 0px 20px; clear: both;">
      <div>
        <!-- Results table start -->
        <table class="govuk-table" id="submission-table">
          <thead class="govuk-table__head">
            <tr>
              <td class="govuk-table__cell"
                style="width: 420px; text-align:left; padding: 10px 20px 10px 0px; border-bottom:0px;">0 records
                selected
              </td>
              <td class="govuk-table__cell"
                style="width: 60px; text-align: left; padding: 10px 0px 10px 20px; vertical-align: middle; border-bottom:0px;">
                <strong>10-20 of 7000</strong>
              </td>
            </tr>
          </thead>
        </table>
        <!-- Results table end -->
      </div>
      <h2 class="govuk-heading-m">Filtered results:</h2>
      <!-- TABLE -->
      <table class="govuk-table" class="govuk-table" style="table-layout: fixed; width: 100%;">
        <thead class="govuk-table__head">
          <tr class="govuk-table__row">
            <th scope="col" class="govuk-table__header" style="width: 60px;"></th>
            <th scope="col" class="govuk-table__header" style="width: 170px;">Organisation name</th>
            <th scope="col" class="govuk-table__header" style="width: 160px;">Organisation ID</th>
            <th scope="col" class="govuk-table__header" style="width: 160px;">Billing instruction</th>
            <th scope="col" class="govuk-table__header" style="width: 140px;">Invoice amount</th>
            <th scope="col" class="govuk-table__header" style="width: 140px;">Status</th>
          </tr>
        </thead>

        <tbody class="govuk-table__body" id="submission-table-body">
          <!-- Content start -->
          <tr>
            <td class="govuk-table__cell" style="width: 60px; text-align:left; padding: 10px 20px 10px 0px;">
              <input type="checkbox" id="row-checkbox-1" name="select-row" value="1"
                style="width:34px; height:34px; cursor: pointer; border: 1px solid #000;">
            </td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;"><a href="#"
                class="govuk-link">Acme org Ltd.</a></td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">215148</td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">Initial</td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">£100,000</td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">
              <strong class="govuk-tag govuk-tag--yellow">Pending</strong>
            </td>
          </tr>

          <tr>
            <td class="govuk-table__cell" style="width: 60px; text-align:left; padding: 10px 20px 10px 0px;">
              <input type="checkbox" id="row-checkbox-1" name="select-row" value="1"
                style="width:34px; height:34px; cursor: pointer; border: 1px solid #000;">
            </td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;"><a href="#"
                class="govuk-link">Acme org Ltd.</a></td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">215148</td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">Delta</td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">£100,000</td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">
              <strong class="govuk-tag govuk-tag--green">Accepted</strong>
            </td>
          </tr>


          <tr>
            <td class="govuk-table__cell" style="width: 60px; text-align:left; padding: 10px 20px 10px 0px;">
              <input type="checkbox" id="row-checkbox-1" name="select-row" value="1"
                style="width:34px; height:34px; cursor: pointer; border: 1px solid #000;">
            </td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;"><a href="#"
                class="govuk-link">Acme org Ltd.</a></td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">215148</td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">Rebill</td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">£100,000</td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">
              <strong class="govuk-tag govuk-tag--yellow">Pending</strong>
            </td>
          </tr>

          <tr>
            <td class="govuk-table__cell" style="width: 60px; text-align:left; padding: 10px 20px 10px 0px;">
              <input type="checkbox" id="row-checkbox-1" name="select-row" value="1"
                style="width:34px; height:34px; cursor: pointer; border: 1px solid #000;">
            </td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;"><a href="#"
                class="govuk-link">Acme org Ltd.</a></td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">215148</td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">Cancel bill
            </td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">£100,000</td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">
              <strong class="govuk-tag govuk-tag--red">Rejected</strong>
            </td>
          </tr>

          <tr>
            <td class="govuk-table__cell" style="width: 60px; text-align:left; padding: 10px 20px 10px 0px;">
              <input type="checkbox" id="row-checkbox-1" name="select-row" value="1"
                style="width:34px; height:34px; cursor: pointer; border: 1px solid #000;">
            </td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;"><a href="#"
                class="govuk-link">Acme org Ltd.</a></td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">215148</td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">No action
            </td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">£100,000</td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">
              <strong class="govuk-tag govuk-tag--grey">No action </strong>
            </td>
          </tr>

          <tr>
            <td class="govuk-table__cell" style="width: 60px; text-align:left; padding: 10px 20px 10px 0px;">
              <input type="checkbox" id="row-checkbox-1" name="select-row" value="1"
                style="width:34px; height:34px; cursor: pointer; border: 1px solid #000;">
            </td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;"><a href="#"
                class="govuk-link">Acme org Ltd.</a></td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">215148</td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">Initial</td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">£100,000</td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">
              <strong class="govuk-tag govuk-tag--yellow">Pending</strong>
            </td>
          </tr>

          <tr>
            <td class="govuk-table__cell" style="width: 60px; text-align:left; padding: 10px 20px 10px 0px;">
              <input type="checkbox" id="row-checkbox-1" name="select-row" value="1"
                style="width:34px; height:34px; cursor: pointer; border: 1px solid #000;">
            </td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;"><a href="#"
                class="govuk-link">Acme org Ltd.</a></td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">215148</td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">Delta</td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">£100,000</td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">
              <strong class="govuk-tag govuk-tag--green">Accepted</strong>
            </td>
          </tr>


          <tr>
            <td class="govuk-table__cell" style="width: 60px; text-align:left; padding: 10px 20px 10px 0px;">
              <input type="checkbox" id="row-checkbox-1" name="select-row" value="1"
                style="width:34px; height:34px; cursor: pointer; border: 1px solid #000;">
            </td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;"><a href="#"
                class="govuk-link">Acme org Ltd.</a></td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">215148</td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">Rebill</td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">£100,000</td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">
              <strong class="govuk-tag govuk-tag--yellow">Pending</strong>
            </td>
          </tr>

          <tr>
            <td class="govuk-table__cell" style="width: 60px; text-align:left; padding: 10px 20px 10px 0px;">
              <input type="checkbox" id="row-checkbox-1" name="select-row" value="1"
                style="width:34px; height:34px; cursor: pointer; border: 1px solid #000;">
            </td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;"><a href="#"
                class="govuk-link">Acme org Ltd.</a></td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">215148</td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">Cancel bill
            </td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">£100,000</td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">
              <strong class="govuk-tag govuk-tag--red">Rejected</strong>
            </td>
          </tr>

          <tr>
            <td class="govuk-table__cell" style="width: 60px; text-align:left; padding: 10px 20px 10px 0px;">
              <input type="checkbox" id="row-checkbox-1" name="select-row" value="1"
                style="width:34px; height:34px; cursor: pointer; border: 1px solid #000;">
            </td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;"><a href="#"
                class="govuk-link">Acme org Ltd.</a></td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">215148</td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">No action
            </td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">£100,000</td>
            <td class="govuk-table__cell"
              style="width: 60px; text-align: left; padding: 10px 20px 10px 0px; vertical-align: middle;">
              <strong class="govuk-tag govuk-tag--grey">No action </strong>
            </td>
          </tr>

          <!-- Content end-->
        </tbody>
      </table>




      <!-- Pagination block -->
      <div style="overflow: hidden;">
        <ul class="govuk-pagination__list">
          <li class="govuk-pagination__item govuk-pagination__item--current">
            <a class="govuk-link govuk-pagination__link govuk-link--no-visited-state" href="#" aria-label="Page 1"
              aria-current="page">
              1
            </a>
          </li>
          <li class="govuk-pagination__item">
            <a class="govuk-link govuk-pagination__link govuk-link--no-visited-state" href="#" aria-label="Page 6">
              2
            </a>
          </li>
          <li class="govuk-pagination__item">
            <a class="govuk-link govuk-pagination__link govuk-link--no-visited-state" href="#" aria-label="Page 7">
              3
            </a>
          </li>
          <li class="govuk-pagination__item govuk-pagination__item--ellipses">&ctdot;</li>
          <li class="govuk-pagination__item">
            <a class="govuk-link govuk-pagination__link govuk-link--no-visited-state" href="#" aria-label="Page 42">
              10
            </a>
          </li>
        </ul>
        <div class="govuk-pagination__next">
          <a class="govuk-link govuk-pagination__link link govuk-link--no-visited-state" href="#" rel="next"> <span
              class="govuk-pagination__link-title">Next</span> <svg
              class="govuk-pagination__icon govuk-pagination__icon--next" xmlns="http://www.w3.org/2000/svg" height="13"
              width="15" aria-hidden="true" focusable="false" viewBox="0 0 15 13">
              <path
                d="m8.107-0.0078125-1.4136 1.414 4.2926 4.293h-12.986v2h12.896l-4.1855 3.9766 1.377 1.4492 6.7441-6.4062-6.7246-6.7266z">
              </path>
            </svg></a>
        </div>
      </div>

      <!-- Clear float if needed -->
      <div style="clear: both;"></div>

      <!-- Update billing section -->
      <div style="margin-top: 60px;">
        <h2 class="govuk-heading-m">Update billing instructions</h2>
        {% from "govuk/components/button/macro.njk" import govukButton %}


        {{ govukButton({
        text: "Accept selected",
        href: "#",
        attributes: {
        style: "background-color: #ffffff; border: 1px solid #00703c; color: #00703c; margin-left: 10px;
        margin-left: 0px; box-shadow: 0 2px 0 rgb(0, 112, 60);"
        }
        }) }}

        {{ govukButton({
        text: "Reject selected",
        href: "#",
        attributes: {
        style: "background-color: #ffffff; border: 1px solid #d4351c; color: #d4351c; margin-left: 10px;
        margin-left: 30px; box-shadow: 0 2px 0 rgb(212, 53, 28);"
        }
        }) }}


        {{ govukButton({
        text: "Cancel",
        href: "./2-reason.html",
        classes: "govuk-button--secondary",
        attributes: {
        style: "margin-left: 30px;"
        }
        }) }}

      </div>

      <!-- Next step section -->
      <div style="margin-top: 40px;">
        <h2 class="govuk-heading-m">Next step</h2>
        <p class="govuk-body-m">Submit the billing instructions to generate a draft billing file.</p>
        {{ govukButton({
        text: "Submit instructions",
        href: "#",
        attributes: {
        style: ""
        }
        }) }}
      </div>


      <p class="govuk-body" style="margin-top: 30px;">
        <a href="./small-producer-dashboard-bank-transfer-basic" class="govuk-link">Return to the dashboard</a>
      </p>

    </div>
  </div>
  <!-- Filtered results end -->






</div>

<script>
  document.getElementById('apply-filters').addEventListener('click', function () {
    // Get filter values
    const orgNameFilter = document.getElementById('organisation-name').value.trim().toLowerCase();
    const orgIdFilter = document.getElementById('organisation-id').value.trim().toLowerCase();

    // Get selected checkboxes
    let orgTypeFilters = Array.from(document.querySelectorAll('input[name="orgtype"]:checked')).map(cb => cb.value.trim().toLowerCase());
    let statusFilters = Array.from(document.querySelectorAll('input[name="status"]:checked')).map(cb => cb.value.trim().toLowerCase());

    // Separate resubmission filters
    let resubmissionFilters = statusFilters.filter(status =>
      ["resubmission-pending", "resubmission-accepted", "resubmission-rejected"].includes(status)
    );

    // Filter out resubmission-related statuses from standard status filters
    let standardStatusFilters = statusFilters.filter(status =>
      !["resubmission-pending", "resubmission-accepted", "resubmission-rejected"].includes(status)
    );

    // Define statuses that disable resubmission filtering
    let statusesDisablingResubmission = ["pending", "granted", "refused", "queried", "cancelled"];
    let otherStatusSelected = standardStatusFilters.some(status => statusesDisablingResubmission.includes(status));

    // Get year filters
    let yearFilters = Array.from(document.querySelectorAll('input[name="year"]:checked')).map(cb => cb.value.trim().toLowerCase());

    // Check if no filters are selected
    const noFiltersSelected = !orgNameFilter && !orgIdFilter && orgTypeFilters.length === 0 &&
      statusFilters.length === 0 && yearFilters.length === 0;
    if (noFiltersSelected) {
      window.location.href = '../manage-data-submissions-no-results';
      return;
    }

    console.log('Filters Applied:', { orgNameFilter, orgIdFilter, orgTypeFilters, standardStatusFilters, resubmissionFilters, yearFilters, otherStatusSelected });

    // Get table rows
    const rows = document.querySelectorAll('#submission-table-body tr');
    let anyRowVisible = false; // Track if any row is visible after filtering

    rows.forEach(row => {
      // Extract cell values
      const orgName = row.cells[0].querySelector('a').textContent.trim().toLowerCase();
      const orgId = row.cells[1].textContent.trim().toLowerCase();
      const orgType = row.cells[0].querySelector('span').textContent.trim().toLowerCase();
      const submissionYear = row.cells[3].textContent.trim().toLowerCase();

      // Get Submission Status (Column 5)
      const submissionStatusTags = Array.from(row.cells[4].querySelectorAll('strong')).map(tag => tag.textContent.trim().toLowerCase());

      // Get Resubmission Status (Column 6)
      const resubmissionStatusTags = Array.from(row.cells[5].querySelectorAll('strong[id^="status-resubmission"]')).map(tag => tag.textContent.trim().toLowerCase());

      // Handle resubmission filtering
      if (resubmissionFilters.length > 0 && !otherStatusSelected) {
        let resubmissionMatch = resubmissionStatusTags.some(tag => resubmissionFilters.includes(`resubmission-${tag}`)); // Match specific resubmission status
        let grantedMatch = submissionStatusTags.includes("granted");

        // Only show rows where "Granted" exists AND resubmission status matches the filters
        if (grantedMatch && resubmissionMatch) {
          row.style.display = ''; // Show row
          anyRowVisible = true;
        } else {
          row.style.display = 'none'; // Hide row
        }
        return; // Skip other filters when Resubmission is active
      }

      // Match Submission Status (Normal filtering)
      const submissionStatusMatch = standardStatusFilters.length === 0 ||
        standardStatusFilters.some(filter => submissionStatusTags.includes(filter));

      // Apply all other filter conditions
      const orgNameMatch = !orgNameFilter || orgName.includes(orgNameFilter);
      const orgIdMatch = !orgIdFilter || orgId.includes(orgIdFilter);
      const orgTypeMatch = orgTypeFilters.length === 0 || orgTypeFilters.includes(orgType);
      const yearMatch = yearFilters.length === 0 || yearFilters.includes(submissionYear);

      // Final row visibility check
      if (orgNameMatch && orgIdMatch && orgTypeMatch && submissionStatusMatch && yearMatch) {
        row.style.display = ''; // Show row
        anyRowVisible = true;
      } else {
        row.style.display = 'none'; // Hide row
      }
    });

    if (!anyRowVisible) {
      window.location.href = '../manage-data-submissions-no-results';
    }
  });

  // Clear filters
  document.getElementById('clear-filters').addEventListener('click', function (event) {
    event.preventDefault();
    document.getElementById('filter-form').reset();
    document.querySelectorAll('#submission-table-body tr').forEach(row => {
      row.style.display = ''; // Show all rows
    });
  });

</script>

{% endblock %}